# Frontend MongoDB Integration Guide

## üìã Overview

MongoDB integration is **complete and tested** on the backend. The frontend now needs to save/restore project state using `project_id`.

---

## üîë Project ID Format

### What is it?
```javascript
// Example project_id returned from API:
"17cab6a0-3bd4-4ae0-9c71-1234567890ab"
```

### Format Specification:
- **Type**: UUID v4 (Universally Unique Identifier)
- **Length**: 36 characters
- **Format**: `xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx`
- **Characters**: Lowercase hexadecimal (0-9, a-f)
- **Example**: `"860a4cf2-03ac-4a6d-8c71-abc123def456"`

### Generated By:
```python
# Backend generates using Python's uuid module:
import uuid
project_id = str(uuid.uuid4())
```

---

## üîÑ How Auto-Save Works (Already Implemented)

When user generates a wireframe, the backend **automatically**:

1. ‚úÖ Saves wireframe to MongoDB
2. ‚úÖ Returns `project_id` in the response
3. ‚úÖ Generates auto name like: `"Untitled Project 01/18 06:54"`

### API Responses with project_id:

```javascript
// POST /generate - Text generation
{
  "success": true,
  "project_id": "17cab6a0-3bd4-4ae0-9c71-1234567890ab",  // ‚Üê SAVE THIS
  "wireframe_layout": { /* ... */ },
  "message": "Wireframe generated successfully"
}

// POST /vision/analyze - Image/sketch analysis
{
  "success": true,
  "project_id": "860a4cf2-03ac-4a6d-8c71-abc123def456",  // ‚Üê SAVE THIS
  "wireframe_layout": { /* ... */ }
}

// POST /hybrid - Text + Image
{
  "success": true,
  "project_id": "a1b2c3d4-e5f6-7890-abcd-ef1234567890",  // ‚Üê SAVE THIS
  "wireframe_layout": { /* ... */ }
}

// POST /edit - Editing wireframe
{
  "success": true,
  "project_id": "17cab6a0-3bd4-4ae0-9c71-1234567890ab",  // Same ID, updated
  "wireframe_layout": { /* ... */ }
}
```

---

## üéØ Frontend Implementation (3 Simple Steps)

### Step 1: Save project_id After Generation

```javascript
// In your generate/vision/hybrid API call handler:

async function generateWireframe(userInput) {
  const response = await fetch('http://localhost:8000/generate', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
      user_input: userInput,
      device_type: 'macbook',
      use_scraper: false
    })
  });
  
  const data = await response.json();
  
  if (data.success && data.project_id) {
    // ‚úÖ STEP 1: Save to localStorage
    localStorage.setItem('currentProjectId', data.project_id);
    console.log('üíæ Saved project:', data.project_id);
  }
  
  return data.wireframe_layout;
}
```

### Step 2: Restore on Page Load

```javascript
// In your main App component (useEffect or componentDidMount):

async function restoreProjectFromLocalStorage() {
  const projectId = localStorage.getItem('currentProjectId');
  
  if (!projectId) {
    console.log('No saved project found');
    return null;
  }
  
  try {
    // ‚úÖ STEP 2: Fetch from MongoDB
    const response = await fetch(`http://localhost:8000/projects/${projectId}`);
    
    if (response.ok) {
      const project = await response.json();
      console.log('‚úÖ Restored project:', project.name);
      return project.wireframe; // Load this into your canvas
    } else if (response.status === 404) {
      console.log('Project not found (deleted?)');
      localStorage.removeItem('currentProjectId');
      return null;
    }
  } catch (error) {
    console.error('Failed to restore project:', error);
    return null;
  }
}

// Call on page load:
useEffect(() => {
  restoreProjectFromLocalStorage().then(wireframe => {
    if (wireframe) {
      setWireframeData(wireframe); // Update your state
    }
  });
}, []);
```

### Step 3: Manual Save Button (Optional)

```javascript
// Add a "Save" button that explicitly saves current state:

async function handleManualSave() {
  const projectId = localStorage.getItem('currentProjectId');
  
  if (!projectId) {
    alert('No project to save');
    return;
  }
  
  try {
    // ‚úÖ STEP 3: Manual save endpoint
    const response = await fetch(`http://localhost:8000/projects/${projectId}/save`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        wireframe: currentWireframeData,  // Your current canvas state
        name: projectName,                 // Optional: custom name
        instruction: 'Manual save'         // Optional: note
      })
    });
    
    if (response.ok) {
      const result = await response.json();
      console.log('üíæ Saved at:', result.updated_at);
      alert('Project saved!');
    }
  } catch (error) {
    console.error('Save failed:', error);
    alert('Failed to save');
  }
}
```

---

## üìö All Available MongoDB Endpoints

### 1. **List All Projects**
```javascript
GET /projects
// Returns array of project summaries

const response = await fetch('http://localhost:8000/projects');
const projects = await response.json();
// [{ _id, name, created_at, component_count, ... }]
```

### 2. **Get Specific Project**
```javascript
GET /projects/{project_id}
// Returns full project with wireframe

const response = await fetch(`http://localhost:8000/projects/${projectId}`);
const project = await response.json();
// { _id, name, wireframe, created_at, updated_at, edit_history, ... }
```

### 3. **Manual Save**
```javascript
POST /projects/{project_id}/save
Body: { wireframe, name?, instruction? }
// Updates project in MongoDB

await fetch(`http://localhost:8000/projects/${projectId}/save`, {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({ wireframe, name: 'My Project' })
});
```

### 4. **Rename Project**
```javascript
PATCH /projects/{project_id}/rename
Body: { name }
// Changes project name

await fetch(`http://localhost:8000/projects/${projectId}/rename`, {
  method: 'PATCH',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({ name: 'Dashboard Redesign' })
});
```

### 5. **Delete Project**
```javascript
DELETE /projects/{project_id}
// Removes from MongoDB

await fetch(`http://localhost:8000/projects/${projectId}`, {
  method: 'DELETE'
});
localStorage.removeItem('currentProjectId');
```

### 6. **Get Project Stats**
```javascript
GET /projects/stats/summary
// Returns { total_projects, total_components, ... }

const response = await fetch('http://localhost:8000/projects/stats/summary');
const stats = await response.json();
```

---

## üé® UI/UX Recommendations

### Visual Indicators:

```javascript
// Show save status in UI:
function SaveStatusIndicator() {
  const [lastSaved, setLastSaved] = useState(null);
  
  useEffect(() => {
    // After any generation/edit:
    if (projectId) {
      setLastSaved(new Date());
    }
  }, [projectId]);
  
  return (
    <div className="save-status">
      {lastSaved ? (
        <>
          <span className="icon">üíæ</span>
          <span>Saved {formatTimeAgo(lastSaved)}</span>
        </>
      ) : (
        <span className="unsaved">Unsaved changes</span>
      )}
    </div>
  );
}
```

### Project Name Display:

```javascript
// Show auto-generated name with edit option:
function ProjectNameHeader() {
  const [projectName, setProjectName] = useState('');
  const [isEditing, setIsEditing] = useState(false);
  
  useEffect(() => {
    // Load project name from API
    if (projectId) {
      fetch(`http://localhost:8000/projects/${projectId}`)
        .then(r => r.json())
        .then(p => setProjectName(p.name));
    }
  }, [projectId]);
  
  const handleRename = async (newName) => {
    await fetch(`http://localhost:8000/projects/${projectId}/rename`, {
      method: 'PATCH',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ name: newName })
    });
    setProjectName(newName);
    setIsEditing(false);
  };
  
  return (
    <div className="project-name">
      {isEditing ? (
        <input 
          value={projectName}
          onChange={(e) => setProjectName(e.target.value)}
          onBlur={() => handleRename(projectName)}
        />
      ) : (
        <h2 onClick={() => setIsEditing(true)}>
          {projectName || 'Untitled Project'}
          <span className="edit-icon">‚úèÔ∏è</span>
        </h2>
      )}
    </div>
  );
}
```

---

## üî• Complete React Example

```jsx
import React, { useState, useEffect } from 'react';

const API_BASE = 'http://localhost:8000';

function WireframeEditor() {
  const [projectId, setProjectId] = useState(null);
  const [projectName, setProjectName] = useState('');
  const [wireframe, setWireframe] = useState(null);
  const [lastSaved, setLastSaved] = useState(null);

  // ‚úÖ RESTORE on mount
  useEffect(() => {
    const savedId = localStorage.getItem('currentProjectId');
    if (savedId) {
      restoreProject(savedId);
    }
  }, []);

  async function restoreProject(id) {
    try {
      const response = await fetch(`${API_BASE}/projects/${id}`);
      if (response.ok) {
        const project = await response.json();
        setProjectId(project._id);
        setProjectName(project.name);
        setWireframe(project.wireframe);
        setLastSaved(new Date(project.updated_at));
        console.log('‚úÖ Restored:', project.name);
      }
    } catch (error) {
      console.error('Failed to restore:', error);
      localStorage.removeItem('currentProjectId');
    }
  }

  async function generateFromText(userInput) {
    try {
      const response = await fetch(`${API_BASE}/generate`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          user_input: userInput,
          device_type: 'macbook'
        })
      });

      const data = await response.json();
      
      if (data.success && data.project_id) {
        // ‚úÖ SAVE project_id
        setProjectId(data.project_id);
        localStorage.setItem('currentProjectId', data.project_id);
        setWireframe(data.wireframe_layout);
        setLastSaved(new Date());
        
        // Load project name
        const projectResponse = await fetch(`${API_BASE}/projects/${data.project_id}`);
        const project = await projectResponse.json();
        setProjectName(project.name);
      }
    } catch (error) {
      console.error('Generation failed:', error);
    }
  }

  async function handleManualSave() {
    if (!projectId) return;
    
    try {
      const response = await fetch(`${API_BASE}/projects/${projectId}/save`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          wireframe: wireframe,
          name: projectName
        })
      });
      
      if (response.ok) {
        setLastSaved(new Date());
        alert('Saved!');
      }
    } catch (error) {
      console.error('Save failed:', error);
    }
  }

  async function handleRename(newName) {
    if (!projectId) return;
    
    try {
      await fetch(`${API_BASE}/projects/${projectId}/rename`, {
        method: 'PATCH',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ name: newName })
      });
      setProjectName(newName);
    } catch (error) {
      console.error('Rename failed:', error);
    }
  }

  return (
    <div className="wireframe-editor">
      <header>
        <input 
          value={projectName}
          onChange={(e) => setProjectName(e.target.value)}
          onBlur={(e) => handleRename(e.target.value)}
          placeholder="Project Name"
        />
        
        <div className="save-status">
          {lastSaved && `üíæ Saved ${formatTimeAgo(lastSaved)}`}
        </div>
        
        <button onClick={handleManualSave}>
          üíæ Save
        </button>
      </header>

      {/* Your canvas/wireframe display */}
      {wireframe && (
        <div className="canvas">
          {/* Render wireframe components */}
        </div>
      )}
    </div>
  );
}

function formatTimeAgo(date) {
  const seconds = Math.floor((new Date() - date) / 1000);
  if (seconds < 60) return 'just now';
  if (seconds < 3600) return `${Math.floor(seconds / 60)}m ago`;
  return `${Math.floor(seconds / 3600)}h ago`;
}

export default WireframeEditor;
```

---

## ‚úÖ Testing Checklist

- [ ] Generate wireframe ‚Üí Check `project_id` is saved to localStorage
- [ ] Refresh page ‚Üí Wireframe reloads from MongoDB
- [ ] Edit wireframe ‚Üí Changes persist after refresh
- [ ] Rename project ‚Üí Name updates in MongoDB
- [ ] Manual save ‚Üí Data updates in MongoDB
- [ ] Open browser DevTools ‚Üí Check localStorage has `currentProjectId`
- [ ] Check MongoDB Atlas ‚Üí See projects in database

---

## üéØ Summary

**What you need to do:**

1. Save `project_id` from API responses to `localStorage`
2. Load project on page mount using `GET /projects/{id}`
3. Optionally: Add manual save button using `POST /projects/{id}/save`

**What's already working:**

- ‚úÖ Auto-save on all generation endpoints
- ‚úÖ MongoDB persistence (tested with 100% pass rate)
- ‚úÖ Edit history tracking
- ‚úÖ Project listing and management
- ‚úÖ Atlas cloud storage

**The `project_id` is just a UUID string** - treat it like any other ID in your app!

